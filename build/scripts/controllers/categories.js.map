{"version":3,"sources":["categories.es6"],"names":["categories","__constructor","Promise","resolve","pg","load","model","then","location","initialize","list","target","page","current","total","limit","order","sortBy","items","count","Math","ceil","models","length","update","set","num","modifier","floor","mode","show","show_deleteCategoryDialog","id","get","delete_category","delete","form","active","error","title","insert","UI","categoryDeclarationForm","categoryName","Data","category","Error","new","show_categoryDeclarationForm","validate_categoryDeclarationForm","log","setCustomValidity","name","trim","toLowerCase","checkValidity","loader","getByName","hide","save"],"mappings":"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","file":"categories.js","sourcesContent":["/* jsHint inline configuration : */\n/* jshint undef: true, unused: false */\n/* global chrome , System , pg , rivets , sightglass */\n\n\nlet categories = {\n\t__constructor(){\n\t\treturn new Promise(function(resolve){\n\t\t\tpg.load.model('categories').then( r => resolve() );\n\t\t});\n\t},\n\n\tlocation : 'categories/list',\n\n\tinitialize : function(){ categories.list.initialize(); },\n\n\tlist : {\n\t\ttarget : null,\n\n\t\tpage:{\n\t\t\tcurrent \t: 1,\t// current page\n\t\t\ttotal \t\t: 1,\t// total pages\n\t\t\tlimit \t\t: 5,\t// limit of items\n\t\t\torder \t\t: 'DESC',\n\t\t\tsortBy \t\t: 'id',\n\t \t\titems \t\t: [],\n\t\t\tcount(){ return( categories.list.page.total = Math.ceil(pg.models.categories.page(0).length / categories.list.page.limit) )},\n\t\t\tupdate(){\n\t\t\t\tcategories.list.page.count();\n\t\t\t\tcategories.list.page.set(categories.list.page.current || 1);\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tset(num, modifier=0){\n\t\t\t\tnum = num + modifier;\n\t\t\t\t// validate pageNum\n\t\t\t\tif(typeof num !== 'number' || num < 1) num = 1;\n\t\t\t\telse if(num > categories.list.page.total) num = categories.list.page.count();\n\t\t\t\tcategories.list.page.current = Math.floor(num);\n\n\t\t\t\tcategories.list.page.items = pg.models.categories.page(categories.list.page.current, categories.list.page.limit);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\n\t\tinitialize :  function(mode = 'insert'){\n\t\t\tcategories.list.page.set(1);\n\t\t\tcategories.list.show();\n\t\t\treturn true;\n\t\t},\n\n\t\tshow : function(){\n\t\t\tcategories.list.page.update();\n\t\t\tcategories.location = 'categories/list';\n\t\t\treturn true;\n\t\t},\n\n\t\tshow_deleteCategoryDialog: function(id){\n\t\t\tcategories.list.target = pg.models.categories.get(id);\n\t\t\tcategories.location = 'categories/list_delete';\n\t\t},\n\n\t\tdelete_category: function(id){\n\t\t\tpg.models.categories.delete(id);\n\t\t\tcategories.list.show();\n\t\t}\n\t},\n\n\tform : {\n\t\tactive \t\t\t\t: 'categoryDeclarationForm',\n\t\tmode \t\t\t\t: 'insert', // | update\n\t\terror \t\t\t\t: false,\n\t\ttitle: {\n\t\t\tinsert \t\t\t: 'New Category :',\n\t\t\tupdate \t\t\t: 'Edit Category :'\n\t\t},\n\n\t\tUI : {\n\t\t\tcategoryDeclarationForm : null,\n\t\t\tcategoryName \t\t\t: null\n\t\t},\n\n\t\tData : {},\n\n\n\t\tinitialize :  function(id = null){\n\t\t\tif( id !== null ){\n\t\t\t\t// EDIT MODE DETECTED! ... get Category Data\n\t\t\t\tlet category = pg.models.categories.get(id);\n\t\t\t\tif( category === -1) throw new Error('categories.form.initialize(): Can\\'t find Category with ID : '+ id);\n\t\t\t\tcategories.form.mode = 'update';\n\t\t\t\tcategories.form.Data = category;\n\t\t\t}else{\n\t\t\t\t// INSERT MODE DETECTED ... generate new Category\n\t\t\t\tcategories.form.mode \t\t= 'insert';\n\t\t\t\tcategories.form.Data \t\t= pg.models.categories.new();\n\t\t\t}\n\n\t\t\tcategories.form.error \t= false;\n\t\t\tcategories.location \t= 'categories/form';\n\t\t\tcategories.form.show_categoryDeclarationForm();\n\t\t\treturn true;\n\t\t},\n\n\t\tshow_categoryDeclarationForm: function(){ categories.form.active = 'categoryDeclarationForm'; },\n\n\t\tvalidate_categoryDeclarationForm: function(){\n\t\t\tpg.log( 'categories.form.validate_categoryDeclarationForm(): Validating Category Declaration...' );\n\t\t\t// reset previous form validations\n\t\t\tcategories.form.error = false;\n\t\t\tcategories.form.UI.categoryName.setCustomValidity('');\n\t\t\t// validate form\n\n\t\t\tcategories.form.Data.name = (categories.form.Data.name || '').trim().toLowerCase();\n\n\t\t\tif( !categories.form.UI.categoryDeclarationForm.checkValidity() ){\n\t\t\t\tpg.log( 'categories.form.validate_categoryDeclarationForm(): Form validation failed...' );\n\t\t\t\tcategories.form.error = 'Some fields require your attention.';\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// show loader\n\t\t\tpg.loader(categories.form.UI.categoryDeclarationForm).show();\n\t\t\t//\n\t\t\t// validation : duplicated name\n\t\t\t//\n\t\t\tif( pg.models.categories.getByName(categories.form.Data.name) !== -1 ){\n\t\t\t\t// if has same ID as duplicated, means is updating entry.... ignore and continue\n\t\t\t\tif( pg.models.categories.getByName(categories.form.Data.name).id !== categories.form.Data.id ){\n\t\t\t\t\tpg.log( 'categories.form.validate_categoryDeclarationForm(): Name validation failed...' );\n\t\t\t\t\tcategories.form.error = 'Category name already exist.';\n\t\t\t\t\tcategories.form.UI.categoryName.setCustomValidity('Category name already exist.');\n\t\t\t\t\tpg.loader(categories.form.UI.categoryDeclarationForm).hide();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// not duplicated! save...\n\t\t\tpg.models.categories.save({\n\t\t\t\tid: categories.form.Data.id,\n\t\t\t\tname: categories.form.Data.name,\n\t\t\t\tcount : 0\n\t\t\t}).then( r=> {\n\t\t\t\t//  hide loader\n\t\t\t\tpg.loader(categories.form.UI.categoryDeclarationForm).hide();\n\t\t\t\t// DONE! display ending message!\n\t\t\t\tcategories.location = 'categories/form_completed';\n\t\t\t});\n\t\t\treturn true;\n\t\t}\n\t}\n};\n\nexport default categories;\n\n"]}