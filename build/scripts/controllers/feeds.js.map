{"version":3,"sources":["feeds.es6"],"names":[],"mappings":"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","file":"feeds.js","sourcesContent":["/* jsHint inline configuration : */\r\n/* jshint undef: true, unused: false */\r\n/* global chrome , System , pg , rivets , sightglass */\r\n\r\n\r\n\r\nlet feeds = {\r\n\t__constructor(){\r\n\t\tpg.log('[Controller]:feeds.__constructor() : Initializating Feeds Controller');\r\n\t\treturn new Promise(function(resolve){\r\n\t\t\tpg.load.model('feeds', 'feedContents', 'categories').then( r => resolve() );\r\n\t\t});\r\n\t},\r\n\r\n\tlocation : 'feeds/list',\r\n\r\n\tinitialize : function(){\r\n\t\t// update available categories\r\n\t\tfeeds.categories = pg.models.categories.page(0);\r\n\t\tfeeds.list.initialize();\r\n\t},\r\n\r\n\tcategories : [],\r\n\r\n\tlist : {\r\n\t\ttarget : null,\r\n\r\n\t\tpage:{\r\n\t\t\tcurrent \t: 1,\t// current page\r\n\t\t\ttotal \t\t: 1,\t// total pages\r\n\t\t\tlimit \t\t: 5,\t// limit of items\r\n\t\t\torder \t\t: 'DESC',\r\n\t\t\tsortBy \t\t: 'id',\r\n\t \t\titems \t\t: [],\r\n\t\t\tcount(){ return( feeds.list.page.total = Math.ceil(pg.models.feeds.page(0).length / feeds.list.page.limit) )},\r\n\t\t\tupdate(){\r\n\t\t\t\tfeeds.list.page.count();\r\n\t\t\t\tfeeds.list.page.set(feeds.list.page.current || 1);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\tset(num, modifier=0){\r\n\t\t\t\tnum = num + modifier;\r\n\t\t\t\t// validate pageNum\r\n\t\t\t\tif(typeof num !== 'number' || num < 1) num = 1;\r\n\t\t\t\telse if(num > feeds.list.page.total) num = feeds.list.page.count();\r\n\t\t\t\tfeeds.list.page.current = Math.floor(num);\r\n\r\n\t\t\t\tfeeds.list.page.items = pg.models.feeds.page(feeds.list.page.current, feeds.list.page.limit);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tinitialize :  function(mode = 'insert'){\r\n\t\t\tfeeds.list.page.set(1);\r\n\t\t\tfeeds.list.show();\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\tshow : function(){\r\n\t\t\tfeeds.list.page.update();\r\n\t\t\tfeeds.location = 'feeds/list';\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\r\n\t\tshow_deleteFeedDialog: function(id){\r\n\t\t\tfeeds.list.target = pg.models.feeds.get(id);\r\n\t\t\tfeeds.location = 'feeds/list_delete';\r\n\t\t},\r\n\r\n\t\tdelete_feed: function(id){\r\n\t\t\tpg.models.feeds.delete(id);\r\n\t\t\tfeeds.list.initialize();\r\n\t\t},\r\n\r\n\t\tgetCategoryName(id){\r\n\r\n\t\t}\r\n\t},\r\n\r\n\tform : {\r\n\t\tactive \t\t\t\t: 'feedDeclarationForm',\r\n\t\tmode \t\t\t\t: 'insert', // | update\r\n\t\terror \t\t\t\t: false,\r\n\t\ttitle: {\r\n\t\t\tinsert \t\t\t: 'New Feed :',\r\n\t\t\tupdate \t\t\t: 'Edit Feed :'\r\n\t\t},\r\n\r\n\t\tUI : {\r\n\t\t\tfeedDeclarationForm \t: null,\r\n\t\t\tfeedAssignationsForm \t: null,\r\n\t\t\tfeedUrl \t\t\t\t: null\r\n\t\t},\r\n\r\n\r\n\t\tData : {},\r\n\r\n\r\n\t\tinitialize :  function(id = null){\r\n\t\t\tif( id !== null ){\r\n\t\t\t\t// EDIT MODE DETECTED! ... get Feed Data\r\n\t\t\t\tlet feed = pg.models.feeds.get(id);\r\n\t\t\t\tif( feed === -1) throw new Error('feeds.form.initialize(): Can\\'t find Feed with ID : '+ id);\r\n\t\t\t\tfeeds.form.mode = 'update';\r\n\t\t\t\tfeeds.form.Data = feed;\r\n\t\t\t}else{\r\n\t\t\t\t// INSERT MODE DETECTED ... generate new Feed\r\n\t\t\t\tfeeds.form.mode \t= 'insert';\r\n\t\t\t\tfeeds.form.Data \t= pg.models.feeds.new();\r\n\t\t\t}\r\n\r\n\t\t\tfeeds.form.error \t= false;\r\n\t\t\tfeeds.location \t\t= 'feeds/form';\r\n\t\t\tfeeds.form.show_feedDeclarationForm();\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\r\n\t\tshow_feedDeclarationForm: function(){ feeds.form.active = 'feedDeclarationForm'; },\r\n\t\tshow_feedAssignationsForm: function(){ feeds.form.active = 'feedAssignationsForm'; },\r\n\r\n\t\tvalidate_feedDeclarationForm: function(){\r\n\t\t\tpg.log( 'feeds.form.validate_feedDeclaration(): Validating Feed Declaration...' );\r\n\t\t\t// reset previous form validations\r\n\t\t\tfeeds.form.error = false;\r\n\t\t\tfeeds.form.UI.feedUrl.setCustomValidity('');\r\n\t\t\t// validate form\r\n\t\t\tif( !feeds.form.UI.feedDeclarationForm.checkValidity() ){\r\n\t\t\t\tpg.log( 'feeds.form.validate_feedDeclaration(): Form validation failed...' );\r\n\t\t\t\tfeeds.form.error = 'Some fields require your attention.';\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t// show loader\r\n\t\t\tpg.loader(feeds.form.UI.feedDeclarationForm).show('Validating Feed Source...');\r\n\t\t\t//\r\n\t\t\t// asyncronic feed url validation\r\n\t\t\t//\r\n\t\t\tpg.models.feedContents.get(feeds.form.Data.url).then(function(_feed){\r\n\t\t\t\t// done! hide loader\r\n\t\t\t\tpg.loader(feeds.form.UI.feedDeclarationForm).hide();\r\n\t\t\t\t// block and return if failed\r\n\t\t\t\tif(!_feed){\r\n\t\t\t\t\tpg.log( 'feeds.form.validate_feedDeclaration(): URL validation failed...' );\r\n\t\t\t\t\tfeeds.form.error = 'RSS Feed not found in URL.';\r\n\t\t\t\t\tfeeds.form.UI.feedUrl.setCustomValidity('RSS Feed not found in URL.');\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\t// TO DO:\r\n\t\t\t\t//  - validate structure 'rss.channel.item'\r\n\t\t\t\t//  - validate item length > 0\r\n\r\n\t\t\t\t// store FEED ITEMS\r\n\t\t\t\tfeeds.form.Data.__items = _feed.rss.channel.item;\r\n\t\t\t\t// succeed, get RSS feed item properties structure\r\n\t\t\t\tfeeds.form.Data.fields.available  =  pg.models.feeds.getItemsProperties(_feed);\r\n\t\t\t\t// DONE ! show next FORM!\r\n\t\t\t\tfeeds.form.show_feedAssignationsForm();\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tvalidate_feedAssignationsForm: function(){\r\n\t\t\tpg.log( 'feeds.form.validate_feedAssignationsForm(): Validating Feed Assignations...' );\r\n\t\t\t// reset previous form validations\r\n\t\t\tfeeds.form.error = false;\r\n\t\t\t// validate form\r\n\t\t\tif( !feeds.form.UI.feedAssignationsForm.checkValidity() ){\r\n\t\t\t\tpg.log( 'feeds.form.validate_feedAssignationsForm(): Form validation failed...' );\r\n\t\t\t\tfeeds.form.error = 'Some fields require your attention.';\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tpg.loader(feeds.form.UI.feedAssignationsForm).show('Validating Feed Assignations...');\r\n\t\t\t// save feed Data\r\n\t\t\tpg.models.feeds.save({\r\n\t\t\t\tid: feeds.form.Data.id,\r\n\t\t\t\tname: feeds.form.Data.name,\r\n\t\t\t\turl : feeds.form.Data.url,\r\n\t\t\t\tfields: {\r\n\t\t\t\t\tavailable: feeds.form.Data.fields.available,\r\n\t\t\t\t\tassignations: {\r\n\t\t\t\t\t\ttitle: feeds.form.Data.fields.assignations.title,\r\n\t\t\t\t\t\tmagnet: feeds.form.Data.fields.assignations.magnet,\r\n\t\t\t\t\t\turl: feeds.form.Data.fields.assignations.url\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tTTL: feeds.form.Data.TTL,\r\n\t\t\t\tcategories: feeds.form.Data.categories,\r\n\t\t\t\tstatus: {\r\n\t\t\t\t\tlastCheck: new Date(),\r\n\t\t\t\t\tcode: 200,\r\n\t\t\t\t\tdetails: undefined\r\n\t\t\t\t}\r\n\t\t\t}).then( r=> {\r\n\t\t\t\t//  hide loader\r\n\t\t\t\tpg.loader(feeds.form.UI.feedAssignationsForm).hide();\r\n\t\t\t\t// DONE! display ending message!\r\n\t\t\t\tfeeds.location = 'feeds/form_completed';\r\n\t\t\t});\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nexport default feeds;\r\n"]}