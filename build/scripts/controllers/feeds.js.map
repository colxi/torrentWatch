{"version":3,"sources":["feeds.es6"],"names":["feeds","__constructor","pg","log","Promise","resolve","load","model","then","location","initialize","categories","models","page","list","target","current","total","limit","order","sortBy","items","count","Math","ceil","length","update","set","num","modifier","floor","mode","show","show_deleteFeedDialog","id","get","delete_feed","delete","getCategoryName","form","active","error","title","insert","UI","feedDeclarationForm","feedAssignationsForm","feedUrl","Data","feed","Error","new","show_feedDeclarationForm","show_feedAssignationsForm","validate_feedDeclarationForm","setCustomValidity","checkValidity","loader","feedContents","url","_feed","hide","__items","rss","channel","item","fields","available","getItemsProperties","validate_feedAssignationsForm","save","name","assignations","magnet","TTL","status","lastCheck","Date","code","details","undefined"],"mappings":";;;;;AAAA;AACA;AACA;;AAIA,IAAIA,QAAQ;AACXC,cADW,2BACI;AACdC,KAAGC,GAAH,CAAO,sEAAP;AACA,SAAO,IAAIC,OAAJ,CAAY,UAASC,OAAT,EAAiB;AACnCH,MAAGI,IAAH,CAAQC,KAAR,CAAc,OAAd,EAAuB,cAAvB,EAAuC,YAAvC,EAAqDC,IAArD,CAA2D;AAAA,WAAKH,SAAL;AAAA,IAA3D;AACA,GAFM,CAAP;AAGA,EANU;;;AAQXI,WAAW,YARA;;AAUXC,aAAa,sBAAU;AACtB;AACAV,QAAMW,UAAN,GAAmBT,GAAGU,MAAH,CAAUD,UAAV,CAAqBE,IAArB,CAA0B,CAA1B,CAAnB;AACAb,QAAMc,IAAN,CAAWJ,UAAX;AACA,EAdU;;AAgBXC,aAAa,EAhBF;;AAkBXG,OAAO;AACNC,UAAS,IADH;;AAGNF,QAAK;AACJG,YAAW,CADP,EACU;AACdC,UAAU,CAFN,EAES;AACbC,UAAU,CAHN,EAGS;AACbC,UAAU,MAJN;AAKJC,WAAW,IALP;AAMHC,UAAU,EANP;AAOJC,QAPI,mBAOG;AAAE,WAAQtB,MAAMc,IAAN,CAAWD,IAAX,CAAgBI,KAAhB,GAAwBM,KAAKC,IAAL,CAAUtB,GAAGU,MAAH,CAAUZ,KAAV,CAAgBa,IAAhB,CAAqB,CAArB,EAAwBY,MAAxB,GAAiCzB,MAAMc,IAAN,CAAWD,IAAX,CAAgBK,KAA3D,CAAhC;AAAoG,IAPzG;AAQJQ,SARI,oBAQI;AACP1B,UAAMc,IAAN,CAAWD,IAAX,CAAgBS,KAAhB;AACAtB,UAAMc,IAAN,CAAWD,IAAX,CAAgBc,GAAhB,CAAoB3B,MAAMc,IAAN,CAAWD,IAAX,CAAgBG,OAAhB,IAA2B,CAA/C;AACA,WAAO,IAAP;AACA,IAZG;AAaJW,MAbI,eAaAC,GAbA,EAagB;AAAA,QAAXC,QAAW,uEAAF,CAAE;;AACnBD,UAAMA,MAAMC,QAAZ;AACA;AACA,QAAG,OAAOD,GAAP,KAAe,QAAf,IAA2BA,MAAM,CAApC,EAAuCA,MAAM,CAAN,CAAvC,KACK,IAAGA,MAAM5B,MAAMc,IAAN,CAAWD,IAAX,CAAgBI,KAAzB,EAAgCW,MAAM5B,MAAMc,IAAN,CAAWD,IAAX,CAAgBS,KAAhB,EAAN;AACrCtB,UAAMc,IAAN,CAAWD,IAAX,CAAgBG,OAAhB,GAA0BO,KAAKO,KAAL,CAAWF,GAAX,CAA1B;;AAEA5B,UAAMc,IAAN,CAAWD,IAAX,CAAgBQ,KAAhB,GAAwBnB,GAAGU,MAAH,CAAUZ,KAAV,CAAgBa,IAAhB,CAAqBb,MAAMc,IAAN,CAAWD,IAAX,CAAgBG,OAArC,EAA8ChB,MAAMc,IAAN,CAAWD,IAAX,CAAgBK,KAA9D,CAAxB;AACA,WAAO,IAAP;AACA;AAtBG,GAHC;;AA4BNR,cAAc,sBAAyB;AAAA,OAAhBqB,IAAgB,uEAAT,QAAS;;AACtC/B,SAAMc,IAAN,CAAWD,IAAX,CAAgBc,GAAhB,CAAoB,CAApB;AACA3B,SAAMc,IAAN,CAAWkB,IAAX;AACA,UAAO,IAAP;AACA,GAhCK;;AAkCNA,QAAO,gBAAU;AAChBhC,SAAMc,IAAN,CAAWD,IAAX,CAAgBa,MAAhB;AACA1B,SAAMS,QAAN,GAAiB,YAAjB;AACA,UAAO,IAAP;AACA,GAtCK;;AAyCNwB,yBAAuB,+BAASC,EAAT,EAAY;AAClClC,SAAMc,IAAN,CAAWC,MAAX,GAAoBb,GAAGU,MAAH,CAAUZ,KAAV,CAAgBmC,GAAhB,CAAoBD,EAApB,CAApB;AACAlC,SAAMS,QAAN,GAAiB,mBAAjB;AACA,GA5CK;;AA8CN2B,eAAa,qBAASF,EAAT,EAAY;AACxBhC,MAAGU,MAAH,CAAUZ,KAAV,CAAgBqC,MAAhB,CAAuBH,EAAvB;AACAlC,SAAMc,IAAN,CAAWJ,UAAX;AACA,GAjDK;;AAmDN4B,iBAnDM,2BAmDUJ,EAnDV,EAmDa,CAElB;AArDK,EAlBI;;AA0EXK,OAAO;AACNC,UAAa,qBADP;AAENT,QAAW,QAFL,EAEe;AACrBU,SAAY,KAHN;AAINC,SAAO;AACNC,WAAY,YADN;AAENjB,WAAY;AAFN,GAJD;;AASNkB,MAAK;AACJC,wBAAuB,IADnB;AAEJC,yBAAwB,IAFpB;AAGJC,YAAc;AAHV,GATC;;AAgBNC,QAAO,EAhBD;;AAmBNtC,cAAc,sBAAmB;AAAA,OAAVwB,EAAU,uEAAL,IAAK;;AAChC,OAAIA,OAAO,IAAX,EAAiB;AAChB;AACA,QAAIe,OAAO/C,GAAGU,MAAH,CAAUZ,KAAV,CAAgBmC,GAAhB,CAAoBD,EAApB,CAAX;AACA,QAAIe,SAAS,CAAC,CAAd,EAAiB,MAAM,IAAIC,KAAJ,CAAU,yDAAwDhB,EAAlE,CAAN;AACjBlC,UAAMuC,IAAN,CAAWR,IAAX,GAAkB,QAAlB;AACA/B,UAAMuC,IAAN,CAAWS,IAAX,GAAkBC,IAAlB;AACA,IAND,MAMK;AACJ;AACAjD,UAAMuC,IAAN,CAAWR,IAAX,GAAmB,QAAnB;AACA/B,UAAMuC,IAAN,CAAWS,IAAX,GAAmB9C,GAAGU,MAAH,CAAUZ,KAAV,CAAgBmD,GAAhB,EAAnB;AACA;;AAEDnD,SAAMuC,IAAN,CAAWE,KAAX,GAAoB,KAApB;AACAzC,SAAMS,QAAN,GAAmB,YAAnB;AACAT,SAAMuC,IAAN,CAAWa,wBAAX;AACA,UAAO,IAAP;AACA,GApCK;;AAuCNA,4BAA0B,oCAAU;AAAEpD,SAAMuC,IAAN,CAAWC,MAAX,GAAoB,qBAApB;AAA4C,GAvC5E;AAwCNa,6BAA2B,qCAAU;AAAErD,SAAMuC,IAAN,CAAWC,MAAX,GAAoB,sBAApB;AAA6C,GAxC9E;;AA0CNc,gCAA8B,wCAAU;AACvCpD,MAAGC,GAAH,CAAQ,uEAAR;AACA;AACAH,SAAMuC,IAAN,CAAWE,KAAX,GAAmB,KAAnB;AACAzC,SAAMuC,IAAN,CAAWK,EAAX,CAAcG,OAAd,CAAsBQ,iBAAtB,CAAwC,EAAxC;AACA;AACA,OAAI,CAACvD,MAAMuC,IAAN,CAAWK,EAAX,CAAcC,mBAAd,CAAkCW,aAAlC,EAAL,EAAwD;AACvDtD,OAAGC,GAAH,CAAQ,kEAAR;AACAH,UAAMuC,IAAN,CAAWE,KAAX,GAAmB,qCAAnB;AACA,WAAO,KAAP;AACA;AACD;AACAvC,MAAGuD,MAAH,CAAUzD,MAAMuC,IAAN,CAAWK,EAAX,CAAcC,mBAAxB,EAA6Cb,IAA7C,CAAkD,2BAAlD;AACA;AACA;AACA;AACA9B,MAAGU,MAAH,CAAU8C,YAAV,CAAuBvB,GAAvB,CAA2BnC,MAAMuC,IAAN,CAAWS,IAAX,CAAgBW,GAA3C,EAAgDnD,IAAhD,CAAqD,UAASoD,KAAT,EAAe;AACnE;AACA1D,OAAGuD,MAAH,CAAUzD,MAAMuC,IAAN,CAAWK,EAAX,CAAcC,mBAAxB,EAA6CgB,IAA7C;AACA;AACA,QAAG,CAACD,KAAJ,EAAU;AACT1D,QAAGC,GAAH,CAAQ,iEAAR;AACAH,WAAMuC,IAAN,CAAWE,KAAX,GAAmB,4BAAnB;AACAzC,WAAMuC,IAAN,CAAWK,EAAX,CAAcG,OAAd,CAAsBQ,iBAAtB,CAAwC,4BAAxC;AACA,YAAO,KAAP;AACA;AACD;AACA;AACA;;AAEA;AACAvD,UAAMuC,IAAN,CAAWS,IAAX,CAAgBc,OAAhB,GAA0BF,MAAMG,GAAN,CAAUC,OAAV,CAAkBC,IAA5C;AACA;AACAjE,UAAMuC,IAAN,CAAWS,IAAX,CAAgBkB,MAAhB,CAAuBC,SAAvB,GAAqCjE,GAAGU,MAAH,CAAUZ,KAAV,CAAgBoE,kBAAhB,CAAmCR,KAAnC,CAArC;AACA;AACA5D,UAAMuC,IAAN,CAAWc,yBAAX;AACA,IApBD;AAqBA,GA/EK;;AAiFNgB,iCAA+B,yCAAU;AACxCnE,MAAGC,GAAH,CAAQ,6EAAR;AACA;AACAH,SAAMuC,IAAN,CAAWE,KAAX,GAAmB,KAAnB;AACA;AACA,OAAI,CAACzC,MAAMuC,IAAN,CAAWK,EAAX,CAAcE,oBAAd,CAAmCU,aAAnC,EAAL,EAAyD;AACxDtD,OAAGC,GAAH,CAAQ,uEAAR;AACAH,UAAMuC,IAAN,CAAWE,KAAX,GAAmB,qCAAnB;AACA,WAAO,KAAP;AACA;AACDvC,MAAGuD,MAAH,CAAUzD,MAAMuC,IAAN,CAAWK,EAAX,CAAcE,oBAAxB,EAA8Cd,IAA9C,CAAmD,iCAAnD;AACA;AACA9B,MAAGU,MAAH,CAAUZ,KAAV,CAAgBsE,IAAhB,CAAqB;AACpBpC,QAAIlC,MAAMuC,IAAN,CAAWS,IAAX,CAAgBd,EADA;AAEpBqC,UAAMvE,MAAMuC,IAAN,CAAWS,IAAX,CAAgBuB,IAFF;AAGpBZ,SAAM3D,MAAMuC,IAAN,CAAWS,IAAX,CAAgBW,GAHF;AAIpBO,YAAQ;AACPC,gBAAWnE,MAAMuC,IAAN,CAAWS,IAAX,CAAgBkB,MAAhB,CAAuBC,SAD3B;AAEPK,mBAAc;AACb9B,aAAO1C,MAAMuC,IAAN,CAAWS,IAAX,CAAgBkB,MAAhB,CAAuBM,YAAvB,CAAoC9B,KAD9B;AAEb+B,cAAQzE,MAAMuC,IAAN,CAAWS,IAAX,CAAgBkB,MAAhB,CAAuBM,YAAvB,CAAoCC,MAF/B;AAGbd,WAAK3D,MAAMuC,IAAN,CAAWS,IAAX,CAAgBkB,MAAhB,CAAuBM,YAAvB,CAAoCb;AAH5B;AAFP,KAJY;AAYpBe,SAAK1E,MAAMuC,IAAN,CAAWS,IAAX,CAAgB0B,GAZD;AAapB/D,gBAAYX,MAAMuC,IAAN,CAAWS,IAAX,CAAgBrC,UAbR;AAcpBgE,YAAQ;AACPC,gBAAW,IAAIC,IAAJ,EADJ;AAEPC,WAAM,GAFC;AAGPC,cAASC;AAHF;AAdY,IAArB,EAmBGxE,IAnBH,CAmBS,aAAI;AACZ;AACAN,OAAGuD,MAAH,CAAUzD,MAAMuC,IAAN,CAAWK,EAAX,CAAcE,oBAAxB,EAA8Ce,IAA9C;AACA;AACA7D,UAAMS,QAAN,GAAiB,sBAAjB;AACA,IAxBD;AAyBA,UAAO,IAAP;AACA;AAvHK;AA1EI,CAAZ;;kBAqMeT,K","file":"feeds.js","sourcesContent":["/* jsHint inline configuration : */\n/* jshint undef: true, unused: false */\n/* global chrome , System , pg , rivets , sightglass */\n\n\n\nlet feeds = {\n\t__constructor(){\n\t\tpg.log('[Controller]:feeds.__constructor() : Initializating Feeds Controller');\n\t\treturn new Promise(function(resolve){\n\t\t\tpg.load.model('feeds', 'feedContents', 'categories').then( r => resolve() );\n\t\t});\n\t},\n\n\tlocation : 'feeds/list',\n\n\tinitialize : function(){\n\t\t// update available categories\n\t\tfeeds.categories = pg.models.categories.page(0);\n\t\tfeeds.list.initialize();\n\t},\n\n\tcategories : [],\n\n\tlist : {\n\t\ttarget : null,\n\n\t\tpage:{\n\t\t\tcurrent \t: 1,\t// current page\n\t\t\ttotal \t\t: 1,\t// total pages\n\t\t\tlimit \t\t: 5,\t// limit of items\n\t\t\torder \t\t: 'DESC',\n\t\t\tsortBy \t\t: 'id',\n\t \t\titems \t\t: [],\n\t\t\tcount(){ return( feeds.list.page.total = Math.ceil(pg.models.feeds.page(0).length / feeds.list.page.limit) )},\n\t\t\tupdate(){\n\t\t\t\tfeeds.list.page.count();\n\t\t\t\tfeeds.list.page.set(feeds.list.page.current || 1);\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tset(num, modifier=0){\n\t\t\t\tnum = num + modifier;\n\t\t\t\t// validate pageNum\n\t\t\t\tif(typeof num !== 'number' || num < 1) num = 1;\n\t\t\t\telse if(num > feeds.list.page.total) num = feeds.list.page.count();\n\t\t\t\tfeeds.list.page.current = Math.floor(num);\n\n\t\t\t\tfeeds.list.page.items = pg.models.feeds.page(feeds.list.page.current, feeds.list.page.limit);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\n\t\tinitialize :  function(mode = 'insert'){\n\t\t\tfeeds.list.page.set(1);\n\t\t\tfeeds.list.show();\n\t\t\treturn true;\n\t\t},\n\n\t\tshow : function(){\n\t\t\tfeeds.list.page.update();\n\t\t\tfeeds.location = 'feeds/list';\n\t\t\treturn true;\n\t\t},\n\n\n\t\tshow_deleteFeedDialog: function(id){\n\t\t\tfeeds.list.target = pg.models.feeds.get(id);\n\t\t\tfeeds.location = 'feeds/list_delete';\n\t\t},\n\n\t\tdelete_feed: function(id){\n\t\t\tpg.models.feeds.delete(id);\n\t\t\tfeeds.list.initialize();\n\t\t},\n\n\t\tgetCategoryName(id){\n\n\t\t}\n\t},\n\n\tform : {\n\t\tactive \t\t\t\t: 'feedDeclarationForm',\n\t\tmode \t\t\t\t: 'insert', // | update\n\t\terror \t\t\t\t: false,\n\t\ttitle: {\n\t\t\tinsert \t\t\t: 'New Feed :',\n\t\t\tupdate \t\t\t: 'Edit Feed :'\n\t\t},\n\n\t\tUI : {\n\t\t\tfeedDeclarationForm \t: null,\n\t\t\tfeedAssignationsForm \t: null,\n\t\t\tfeedUrl \t\t\t\t: null\n\t\t},\n\n\n\t\tData : {},\n\n\n\t\tinitialize :  function(id = null){\n\t\t\tif( id !== null ){\n\t\t\t\t// EDIT MODE DETECTED! ... get Feed Data\n\t\t\t\tlet feed = pg.models.feeds.get(id);\n\t\t\t\tif( feed === -1) throw new Error('feeds.form.initialize(): Can\\'t find Feed with ID : '+ id);\n\t\t\t\tfeeds.form.mode = 'update';\n\t\t\t\tfeeds.form.Data = feed;\n\t\t\t}else{\n\t\t\t\t// INSERT MODE DETECTED ... generate new Feed\n\t\t\t\tfeeds.form.mode \t= 'insert';\n\t\t\t\tfeeds.form.Data \t= pg.models.feeds.new();\n\t\t\t}\n\n\t\t\tfeeds.form.error \t= false;\n\t\t\tfeeds.location \t\t= 'feeds/form';\n\t\t\tfeeds.form.show_feedDeclarationForm();\n\t\t\treturn true;\n\t\t},\n\n\n\t\tshow_feedDeclarationForm: function(){ feeds.form.active = 'feedDeclarationForm'; },\n\t\tshow_feedAssignationsForm: function(){ feeds.form.active = 'feedAssignationsForm'; },\n\n\t\tvalidate_feedDeclarationForm: function(){\n\t\t\tpg.log( 'feeds.form.validate_feedDeclaration(): Validating Feed Declaration...' );\n\t\t\t// reset previous form validations\n\t\t\tfeeds.form.error = false;\n\t\t\tfeeds.form.UI.feedUrl.setCustomValidity('');\n\t\t\t// validate form\n\t\t\tif( !feeds.form.UI.feedDeclarationForm.checkValidity() ){\n\t\t\t\tpg.log( 'feeds.form.validate_feedDeclaration(): Form validation failed...' );\n\t\t\t\tfeeds.form.error = 'Some fields require your attention.';\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// show loader\n\t\t\tpg.loader(feeds.form.UI.feedDeclarationForm).show('Validating Feed Source...');\n\t\t\t//\n\t\t\t// asyncronic feed url validation\n\t\t\t//\n\t\t\tpg.models.feedContents.get(feeds.form.Data.url).then(function(_feed){\n\t\t\t\t// done! hide loader\n\t\t\t\tpg.loader(feeds.form.UI.feedDeclarationForm).hide();\n\t\t\t\t// block and return if failed\n\t\t\t\tif(!_feed){\n\t\t\t\t\tpg.log( 'feeds.form.validate_feedDeclaration(): URL validation failed...' );\n\t\t\t\t\tfeeds.form.error = 'RSS Feed not found in URL.';\n\t\t\t\t\tfeeds.form.UI.feedUrl.setCustomValidity('RSS Feed not found in URL.');\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t// TO DO:\n\t\t\t\t//  - validate structure 'rss.channel.item'\n\t\t\t\t//  - validate item length > 0\n\n\t\t\t\t// store FEED ITEMS\n\t\t\t\tfeeds.form.Data.__items = _feed.rss.channel.item;\n\t\t\t\t// succeed, get RSS feed item properties structure\n\t\t\t\tfeeds.form.Data.fields.available  =  pg.models.feeds.getItemsProperties(_feed);\n\t\t\t\t// DONE ! show next FORM!\n\t\t\t\tfeeds.form.show_feedAssignationsForm();\n\t\t\t});\n\t\t},\n\n\t\tvalidate_feedAssignationsForm: function(){\n\t\t\tpg.log( 'feeds.form.validate_feedAssignationsForm(): Validating Feed Assignations...' );\n\t\t\t// reset previous form validations\n\t\t\tfeeds.form.error = false;\n\t\t\t// validate form\n\t\t\tif( !feeds.form.UI.feedAssignationsForm.checkValidity() ){\n\t\t\t\tpg.log( 'feeds.form.validate_feedAssignationsForm(): Form validation failed...' );\n\t\t\t\tfeeds.form.error = 'Some fields require your attention.';\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tpg.loader(feeds.form.UI.feedAssignationsForm).show('Validating Feed Assignations...');\n\t\t\t// save feed Data\n\t\t\tpg.models.feeds.save({\n\t\t\t\tid: feeds.form.Data.id,\n\t\t\t\tname: feeds.form.Data.name,\n\t\t\t\turl : feeds.form.Data.url,\n\t\t\t\tfields: {\n\t\t\t\t\tavailable: feeds.form.Data.fields.available,\n\t\t\t\t\tassignations: {\n\t\t\t\t\t\ttitle: feeds.form.Data.fields.assignations.title,\n\t\t\t\t\t\tmagnet: feeds.form.Data.fields.assignations.magnet,\n\t\t\t\t\t\turl: feeds.form.Data.fields.assignations.url\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tTTL: feeds.form.Data.TTL,\n\t\t\t\tcategories: feeds.form.Data.categories,\n\t\t\t\tstatus: {\n\t\t\t\t\tlastCheck: new Date(),\n\t\t\t\t\tcode: 200,\n\t\t\t\t\tdetails: undefined\n\t\t\t\t}\n\t\t\t}).then( r=> {\n\t\t\t\t//  hide loader\n\t\t\t\tpg.loader(feeds.form.UI.feedAssignationsForm).hide();\n\t\t\t\t// DONE! display ending message!\n\t\t\t\tfeeds.location = 'feeds/form_completed';\n\t\t\t});\n\t\t\treturn true;\n\t\t}\n\t}\n};\n\nexport default feeds;\n"]}