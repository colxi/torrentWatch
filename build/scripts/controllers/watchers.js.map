{"version":3,"sources":["watchers.es6"],"names":["watchers","__constructor","Promise","resolve","pg","load","model","then","m","location","initialize","categories","models","page","list","target","current","total","limit","order","sortBy","items","count","Math","ceil","length","update","set","num","modifier","floor","mode","show","show_deleteWatchersDialog","id","get","delete_watchers","delete","form","active","error","title","insert","UI","watcherDeclarationForm","Data","watcher","Error","new","show_watcherDeclarationForm","validate_watchersDeclarationForm","log","checkValidity","loader","save","name","directives","in","has","hide","validate_feedAssignationsForm"],"mappings":"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","file":"watchers.js","sourcesContent":["/* jsHint inline configuration : */\n/* jshint undef: true, unused: false */\n/* global chrome , System , pg , rivets , sightglass */\n\n\n\nlet watchers = {\n\t__constructor(){\n\t\treturn new Promise(function(resolve){\n\t\t\tpg.load.model('watchers', 'categories').then( m =>resolve(watchers.model = m) );\n\t\t});\n\t},\n\n\tlocation : 'watchers/list',\n\n\tinitialize : function(){\n\t\twatchers.categories = pg.models.categories.page(0);\n\t\twatchers.list.initialize();\n\t},\n\n\tcategories : [],\n\n\tlist : {\n\t\ttarget : null,\n\n\t\tpage:{\n\t\t\tcurrent \t: 1,\t// current page\n\t\t\ttotal \t\t: 1,\t// total pages\n\t\t\tlimit \t\t: 5,\t// limit of items\n\t\t\torder \t\t: 'DESC',\n\t\t\tsortBy \t\t: 'id',\n\t \t\titems \t\t: [],\n\t\t\tcount(){ return( watchers.list.page.total = Math.ceil(pg.models.watchers.page(0).length / watchers.list.page.limit) )},\n\t\t\tupdate(){\n\t\t\t\twatchers.list.page.count();\n\t\t\t\twatchers.list.page.set(watchers.list.page.current || 1);\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tset(num, modifier=0){\n\t\t\t\tnum = num + modifier;\n\t\t\t\t// validate pageNum\n\t\t\t\tif(typeof num !== 'number' || num < 1) num = 1;\n\t\t\t\telse if(num > watchers.list.page.total) num = watchers.list.page.count();\n\t\t\t\twatchers.list.page.current = Math.floor(num);\n\n\t\t\t\twatchers.list.page.items = pg.models.watchers.page(watchers.list.page.current, watchers.list.page.limit);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\n\n\t\tinitialize :  function(mode = 'insert'){\n\t\t\twatchers.list.page.set(1);\n\t\t\twatchers.list.show();\n\t\t\treturn true;\n\t\t},\n\n\t\tshow : function(){\n\t\t\twatchers.list.page.update();\n\t\t\twatchers.location = 'watchers/list';\n\t\t\treturn true;\n\t\t},\n\n\n\t\tshow_deleteWatchersDialog: function(id){\n\t\t\twatchers.list.target = pg.models.watchers.get(id);\n\t\t\twatchers.location = 'watchers/list_delete';\n\t\t},\n\n\t\tdelete_watchers: function(id){\n\t\t\tpg.models.watchers.delete(id);\n\t\t\twatchers.list.initialize();\n\t\t}\n\t},\n\n\tmodel: {},\n\n\tform : {\n\t\tactive \t\t\t\t: 'watcherDeclarationForm',\n\t\tmode \t\t\t\t: 'insert', // | update\n\t\terror \t\t\t\t: false,\n\t\ttitle: {\n\t\t\tinsert \t\t\t: 'New Watcher :',\n\t\t\tupdate \t\t\t: 'Edit Watcher :'\n\t\t},\n\n\t\tUI : {\n\t\t\twatcherDeclarationForm \t: null\n\t\t},\n\n\t\tData : {},\n\n\t\tinitialize :  function(id = null){\n\t\t\tif( id !== null ){\n\t\t\t\t// EDIT MODE DETECTED! ... get watchers Data\n\t\t\t\tlet watcher = pg.models.watchers.get(id);\n\t\t\t\tif( watcher === -1) throw new Error('watchers.form.initialize(): Can\\'t find Watcher with ID : '+ id);\n\t\t\t\twatchers.form.mode = 'update';\n\t\t\t\twatchers.form.Data = watcher;\n\t\t\t}else{\n\t\t\t\t// INSERT MODE DETECTED ... generate new watcher\n\t\t\t\twatchers.form.mode \t\t= 'insert';\n\t\t\t\twatchers.form.Data \t\t= pg.models.watchers.new();\n\t\t\t}\n\n\t\t\twatchers.form.error \t= false;\n\t\t\twatchers.location \t\t= 'watchers/form';\n\t\t\twatchers.form.show_watcherDeclarationForm();\n\t\t\treturn true;\n\t\t},\n\n\t\tshow_watcherDeclarationForm: function(){ watchers.form.active = 'watcherDeclarationForm'; },\n\n\t\tvalidate_watchersDeclarationForm: function(){\n\t\t\tpg.log( 'watchers.form.validate_watchersDeclarationForm(): Validating Watcher Declaration...' );\n\t\t\t// reset previous form validations\n\t\t\twatchers.form.error = false;\n\t\t\t// validate form\n\t\t\tif( !watchers.form.UI.watcherDeclarationForm.checkValidity() ){\n\t\t\t\tpg.log( 'watchers.form.validate_watchersDeclarationForm(): Form validation failed...' );\n\t\t\t\twatchers.form.error = 'Some fields require your attention.';\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// show loader\n\t\t\tpg.loader(watchers.form.UI.watcherDeclarationForm).show();\n\t\t\t// save watchers Data\n\t\t\tpg.models.watchers.save({\n\t\t\t\tid: watchers.form.Data.id,\n\t\t\t\tname: watchers.form.Data.name,\n\t\t\t\tcategories \t: watchers.form.Data.categories,\n\t\t\t\tdirectives \t: [\n\t\t\t\t\t{\n\t\t\t\t\t\tin : 'title',\n\t\t\t\t\t\thas : watchers.form.Data.directives\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t}).then( r=> {\n\t\t\t\t//  hide loader\n\t\t\t\tpg.loader(watchers.form.UI.watcherDeclarationForm).hide();\n\t\t\t\t// DONE! display ending message!\n\t\t\t\twatchers.location = 'watchers/form_completed';\n\t\t\t});\n\t\t\treturn true;\n\t\t},\n\n\t\tvalidate_feedAssignationsForm: function(){\n\t\t\t/*\n\t\t\tpg.log( 'feeds.form.validate_feedAssignationsForm(): Validating Feed Assignations...' );\n\t\t\t// reset previous form validations\n\t\t\tfeeds.form.error = false;\n\t\t\t// validate form\n\t\t\tif( !feeds.form.UI.feedAssignationsForm.checkValidity() ){\n\t\t\t\tpg.log( 'feeds.form.validate_feedAssignationsForm(): Form validation failed...' );\n\t\t\t\tfeeds.form.error = 'Some fields require your attention.';\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tloader\n\n\t\t\t// save feed Data\n\t\t\tapp.saveFeed({\n\t\t\t\tid: feeds.form.Data.id,\n\t\t\t\tname: feeds.form.Data.name,\n\t\t\t\turl : feeds.form.Data.url,\n\t\t\t\tfields: {\n\t\t\t\t\tavailable: feeds.form.Data.fields.available,\n\t\t\t\t\tassignations: {\n\t\t\t\t\t\ttitle: feeds.form.Data.fields.assignations.title,\n\t\t\t\t\t\tmagnet: feeds.form.Data.fields.assignations.magnet,\n\t\t\t\t\t\turl: feeds.form.Data.fields.assignations.url\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tTTL: feeds.form.Data.TTL,\n\t\t\t\tcategories: feeds.form.Data.categories,\n\t\t\t\tstatus: {\n\t\t\t\t\tlastCheck: new Date(),\n\t\t\t\t\tcode: 200,\n\t\t\t\t\tdetails: undefined\n\t\t\t\t}\n\t\t\t});\n\t\t\t// DONE! display ending message!\n\t\t\tfeeds.location = 'feeds/form_completed';\n\t\t\treturn true;\n\t\t\t*/\n\t\t}\n\t}\n};\n\nexport default watchers;\n"]}