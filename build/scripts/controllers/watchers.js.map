{"version":3,"sources":["watchers.es6"],"names":[],"mappings":"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","file":"watchers.js","sourcesContent":["/* jsHint inline configuration : */\r\n/* jshint undef: true, unused: false */\r\n/* global chrome , System , pg , rivets , sightglass */\r\n\r\n\r\n\r\nlet watchers = {\r\n\t__constructor(){\r\n\t\treturn new Promise(function(resolve){\r\n\t\t\tpg.load.model('watchers', 'categories').then( m =>resolve(watchers.model = m) );\r\n\t\t});\r\n\t},\r\n\r\n\tlocation : 'watchers/list',\r\n\r\n\tinitialize : function(){\r\n\t\twatchers.categories = pg.models.categories.page(0);\r\n\t\twatchers.list.initialize();\r\n\t},\r\n\r\n\tcategories : [],\r\n\r\n\tlist : {\r\n\t\ttarget : null,\r\n\r\n\t\tpage:{\r\n\t\t\tcurrent \t: 1,\t// current page\r\n\t\t\ttotal \t\t: 1,\t// total pages\r\n\t\t\tlimit \t\t: 5,\t// limit of items\r\n\t\t\torder \t\t: 'DESC',\r\n\t\t\tsortBy \t\t: 'id',\r\n\t \t\titems \t\t: [],\r\n\t\t\tcount(){ return( watchers.list.page.total = Math.ceil(pg.models.watchers.page(0).length / watchers.list.page.limit) )},\r\n\t\t\tupdate(){\r\n\t\t\t\twatchers.list.page.count();\r\n\t\t\t\twatchers.list.page.set(watchers.list.page.current || 1);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\tset(num, modifier=0){\r\n\t\t\t\tnum = num + modifier;\r\n\t\t\t\t// validate pageNum\r\n\t\t\t\tif(typeof num !== 'number' || num < 1) num = 1;\r\n\t\t\t\telse if(num > watchers.list.page.total) num = watchers.list.page.count();\r\n\t\t\t\twatchers.list.page.current = Math.floor(num);\r\n\r\n\t\t\t\twatchers.list.page.items = pg.models.watchers.page(watchers.list.page.current, watchers.list.page.limit);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\tinitialize :  function(mode = 'insert'){\r\n\t\t\twatchers.list.page.set(1);\r\n\t\t\twatchers.list.show();\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\tshow : function(){\r\n\t\t\twatchers.list.page.update();\r\n\t\t\twatchers.location = 'watchers/list';\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\r\n\t\tshow_deleteWatchersDialog: function(id){\r\n\t\t\twatchers.list.target = pg.models.watchers.get(id);\r\n\t\t\twatchers.location = 'watchers/list_delete';\r\n\t\t},\r\n\r\n\t\tdelete_watchers: function(id){\r\n\t\t\tpg.models.watchers.delete(id);\r\n\t\t\twatchers.list.initialize();\r\n\t\t}\r\n\t},\r\n\r\n\tmodel: {},\r\n\r\n\tform : {\r\n\t\tactive \t\t\t\t: 'watcherDeclarationForm',\r\n\t\tmode \t\t\t\t: 'insert', // | update\r\n\t\terror \t\t\t\t: false,\r\n\t\ttitle: {\r\n\t\t\tinsert \t\t\t: 'New Watcher :',\r\n\t\t\tupdate \t\t\t: 'Edit Watcher :'\r\n\t\t},\r\n\r\n\t\tUI : {\r\n\t\t\twatcherDeclarationForm \t: null\r\n\t\t},\r\n\r\n\t\tData : {},\r\n\r\n\t\tinitialize :  function(id = null){\r\n\t\t\tif( id !== null ){\r\n\t\t\t\t// EDIT MODE DETECTED! ... get watchers Data\r\n\t\t\t\tlet watcher = pg.models.watchers.get(id);\r\n\t\t\t\tif( watcher === -1) throw new Error('watchers.form.initialize(): Can\\'t find Watcher with ID : '+ id);\r\n\t\t\t\twatchers.form.mode = 'update';\r\n\t\t\t\twatchers.form.Data = watcher;\r\n\t\t\t}else{\r\n\t\t\t\t// INSERT MODE DETECTED ... generate new watcher\r\n\t\t\t\twatchers.form.mode \t\t= 'insert';\r\n\t\t\t\twatchers.form.Data \t\t= pg.models.watchers.new();\r\n\t\t\t}\r\n\r\n\t\t\twatchers.form.error \t= false;\r\n\t\t\twatchers.location \t\t= 'watchers/form';\r\n\t\t\twatchers.form.show_watcherDeclarationForm();\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\tshow_watcherDeclarationForm: function(){ watchers.form.active = 'watcherDeclarationForm'; },\r\n\r\n\t\tvalidate_watchersDeclarationForm: function(){\r\n\t\t\tpg.log( 'watchers.form.validate_watchersDeclarationForm(): Validating Watcher Declaration...' );\r\n\t\t\t// reset previous form validations\r\n\t\t\twatchers.form.error = false;\r\n\t\t\t// validate form\r\n\t\t\tif( !watchers.form.UI.watcherDeclarationForm.checkValidity() ){\r\n\t\t\t\tpg.log( 'watchers.form.validate_watchersDeclarationForm(): Form validation failed...' );\r\n\t\t\t\twatchers.form.error = 'Some fields require your attention.';\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t// show loader\r\n\t\t\tpg.loader(watchers.form.UI.watcherDeclarationForm).show();\r\n\t\t\t// save watchers Data\r\n\t\t\tpg.models.watchers.save({\r\n\t\t\t\tid: watchers.form.Data.id,\r\n\t\t\t\tname: watchers.form.Data.name,\r\n\t\t\t\tcategories \t: watchers.form.Data.categories,\r\n\t\t\t\tdirectives \t: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tin : 'title',\r\n\t\t\t\t\t\thas : watchers.form.Data.directives\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t}).then( r=> {\r\n\t\t\t\t//  hide loader\r\n\t\t\t\tpg.loader(watchers.form.UI.watcherDeclarationForm).hide();\r\n\t\t\t\t// DONE! display ending message!\r\n\t\t\t\twatchers.location = 'watchers/form_completed';\r\n\t\t\t});\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\tvalidate_feedAssignationsForm: function(){\r\n\t\t\t/*\r\n\t\t\tpg.log( 'feeds.form.validate_feedAssignationsForm(): Validating Feed Assignations...' );\r\n\t\t\t// reset previous form validations\r\n\t\t\tfeeds.form.error = false;\r\n\t\t\t// validate form\r\n\t\t\tif( !feeds.form.UI.feedAssignationsForm.checkValidity() ){\r\n\t\t\t\tpg.log( 'feeds.form.validate_feedAssignationsForm(): Form validation failed...' );\r\n\t\t\t\tfeeds.form.error = 'Some fields require your attention.';\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tloader\r\n\r\n\t\t\t// save feed Data\r\n\t\t\tapp.saveFeed({\r\n\t\t\t\tid: feeds.form.Data.id,\r\n\t\t\t\tname: feeds.form.Data.name,\r\n\t\t\t\turl : feeds.form.Data.url,\r\n\t\t\t\tfields: {\r\n\t\t\t\t\tavailable: feeds.form.Data.fields.available,\r\n\t\t\t\t\tassignations: {\r\n\t\t\t\t\t\ttitle: feeds.form.Data.fields.assignations.title,\r\n\t\t\t\t\t\tmagnet: feeds.form.Data.fields.assignations.magnet,\r\n\t\t\t\t\t\turl: feeds.form.Data.fields.assignations.url\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tTTL: feeds.form.Data.TTL,\r\n\t\t\t\tcategories: feeds.form.Data.categories,\r\n\t\t\t\tstatus: {\r\n\t\t\t\t\tlastCheck: new Date(),\r\n\t\t\t\t\tcode: 200,\r\n\t\t\t\t\tdetails: undefined\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t// DONE! display ending message!\r\n\t\t\tfeeds.location = 'feeds/form_completed';\r\n\t\t\treturn true;\r\n\t\t\t*/\r\n\t\t}\r\n\t}\r\n};\r\n\r\nexport default watchers;\r\n"]}