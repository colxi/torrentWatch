{"version":3,"sources":["../../../src/scripts/controllers/main.es6"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["/* jsHint inline configuration : */\r\n/* jshint undef: true, unused: false */\r\n/* global chrome , rivets , pg  */\r\n\r\n// let main extends pg.__Controller{\r\nlet main ={\r\n\t__constructor(){\r\n\t\treturn new Promise( (resolve,reject) =>{\r\n\t\t\tthis.currentTab  \t= 'tab-feeds';\r\n\r\n\t\t\t// Define pg App Name Reference\r\n\t\t\tpg.config.appReference = 'app'; // window.app\r\n\r\n  \t\t\t// set html file popup\r\n  \t\t\tchrome.browserAction.setPopup( {popup:'views/popup/popup.html'} );\r\n\r\n\t\t\tpg.log('*** Starting Torrent Observer v.' + pg.getVersion() );\r\n\r\n\t\t\t// require module libraries\r\n\t\t\tpg.log('main.__constructor() : Requiring JSON.parseXML...');\r\n\t\t\tpg.require('lib/JSON.parseXML').then( r => {\r\n\t  \t\t\tthis.countFeedsinAllCategories();\r\n\t\t\t\tthis.getAllFeeds().then( r => {\r\n\t\t\t\t\tresolve( );\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t},\r\n\r\n\tinitialize(){\r\n\t\tpg.log('main.initialize(): Popup opened! Binding view...');\r\n\t\t// overwrite DOCUMENT with popup document instance\r\n\t\tlet document  = chrome.extension.getViews({ type: 'popup' })[0].document;\r\n\t\t// Bind & attach rivets view to App controller as non-enumerable property\r\n\t\tlet rv_view = pg.bind( document.querySelector('#pg-app') , { 'app' : app } );\r\n\t\t// if first popup open , assign view; else update binding\r\n\t\tif( !this.hasOwnProperty('__view__') ){\r\n\t\t\tObject.defineProperty(app, '__view__', {\r\n\t\t\t\tvalue: rv_view,\r\n\t\t\t\tenumerable: false ,\r\n\t\t\t\twritable:true,\r\n\t\t\t\tconfigurable: true\r\n\t\t\t});\r\n\t\t}else this.__view__.update();\r\n\t},\r\n\r\n\tloadPage(page){\r\n\t\t/*\r\n\r\n\t\tpg.log('main.loadPage() : Loading Page \"' + page + '\"  ( Controller & View )');\r\n\t\t// overwrite DOCUMENT with popup document instance\r\n\t\tlet document  = chrome.extension.getViews({ type: 'popup' })[0].document;\r\n\t\tvar a = pg.loadController(page).then( (controller) => {\r\n\t\t\t//window[pg.config.appReference].view = controller;\r\n\t\t\tpg.loadView(page).then( _html =>{\r\n\t\t\t\tdocument.querySelector('#pg-view').innerHTML = _html;\r\n\t\t\t\t// Bind & attach rivets view to controller as non-enumerable property\r\n\t\t\t\tlet rv_view =  pg.bind( document.querySelector('#pg-view') , { [page] : controller } );\r\n\t\t\t\tObject.defineProperty(controller, '__view__', {\r\n\t\t\t\t\tvalue: rv_view,\r\n\t\t\t\t\tenumerable: false,\r\n\t\t\t\t\twritable:true,\r\n\t\t\t\t\tconfigurable: true\r\n\t\t\t\t});\r\n\t\t\t\t// make App controller accessible to loaded view , appending it\r\n\t\t\t\tcontroller.__view__.update({ [page] : controller , app:this} );\r\n\t\t\t});\r\n\t\t});\r\n\t\t*/\r\n\t},\r\n\r\n\tData : {\r\n\t\tCategories : [\r\n\t\t\t{\r\n\t\t\t\tid \t\t: 'f11d24b3-be2f-4bdd-d0e0-2ebf9ba0f5c7',\r\n\t\t\t\tname \t: 'movies',\r\n\t\t\t\tfeeds \t: 0\r\n\t\t\t},{\r\n\t\t\t\tid \t\t: 'dd63224e-b59c-4b41-5f99-c63cffbbafe4',\r\n\t\t\t\tname \t: 'music',\r\n\t\t\t\tfeeds \t: 0\r\n\t\t\t},{\r\n\t\t\t\tid \t\t: '44748d67-be92-47a9-a5b6-de502f1e8cb5',\r\n\t\t\t\tname \t: 'software',\r\n\t\t\t\tfeeds \t: 0\r\n\t\t\t},{\r\n\t\t\t\tid \t\t: '91aa33c5-5099-48e8-b6a4-4a5946c0b617',\r\n\t\t\t\tname \t: 'others',\r\n\t\t\t\tfeeds \t: 0\r\n\t\t\t}\r\n\t\t],\r\n\t\tFeeds : [\r\n\t\t\t/*\r\n\t\t\t{\r\n\t\t\t\tid \t\t\t: 'eeed24d2-be2f-42bc-dc3a-3ebf9ba4eff3',\r\n\t\t\t\tname \t\t: 'Kat (All)',\r\n\t\t\t\turl \t\t: 'https://kat.cr/?rss=1',\r\n\t\t\t\tproperies\t: ['title'],\r\n\t\t\t\tTTL \t\t: 10,\r\n\t\t\t\tcategories \t: ['f11d24b3-be2f-4bdd-d0e0-2ebf9ba0f5c7','dd63224e-b59c-4b41-5f99-c63cffbbafe4','44748d67-be92-47a9-a5b6-de502f1e8cb5'],\r\n\t\t\t\tlastUpdate \t: null\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tid \t\t\t: 'd44d24b3-af2f-12bd-abaa-2ebf9ba0f5c3',\r\n\t\t\t\tname \t\t: 'Kat Movies',\r\n\t\t\t\turl \t\t: 'https://kat.cr/movies/?rss=1',\r\n\t\t\t\tproperies\t: ['title'],\r\n\t\t\t\tTTL \t\t: 10,\r\n\t\t\t\tcategories \t: ['f11d24b3-be2f-4bdd-d0e0-2ebf9ba0f5c7'],\r\n\t\t\t\tlastUpdate \t: null\r\n\t\t\t},\r\n\t\t\t*/\r\n\t\t\t{\r\n\t\t\t\tid \t\t\t: 'a34d24b3-cc2f-6add-b2f0-5ebe9ac0f521',\r\n\t\t\t\tname \t\t: 'Mininova Movies',\r\n\t\t\t\turl \t\t: 'http://www.mininova.org/rss.xml?cat=4',\r\n\t\t\t\tproperies\t: ['title'],\r\n\t\t\t\tTTL \t\t: 10,\r\n\t\t\t\tcategories \t: ['f11d24b3-be2f-4bdd-d0e0-2ebf9ba0f5c7'],\r\n\t\t\t\tlastUpdate \t: null\r\n\t\t\t},{\r\n\t\t\t\tid \t\t\t: 'bdv424b6-cb1c-3aab-11b3-ac429bb0f530',\r\n\t\t\t\tname \t\t: 'YIFY Movies',\r\n\t\t\t\turl \t\t: 'https://yts.ag/rss',\r\n\t\t\t\tproperies\t: ['title'],\r\n\t\t\t\tTTL \t\t: 10,\r\n\t\t\t\tcategories \t: ['f11d24b3-be2f-4bdd-d0e0-2ebf9ba0f5c7'],\r\n\t\t\t\tlastUpdate \t: null\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\r\n\tgetCategoryById(id){\r\n\t\t\tlet i = this.Data.Categories.findIndex( cat=>(cat.id === id ) ? true : false );\r\n\t\t\treturn (i === -1) ? -1 : this.Data.Categories[i];\r\n\t},\r\n\r\n\tgetCategoryByName(id){\r\n\t\tlet i = this.Data.Categories.findIndex( cat=>(cat.name === id ) ? true : false );\r\n\t\treturn (i === -1) ? -1 : this.Data.Categories[i];\r\n\t},\r\n\r\n\tcountFeedsinCategory(id){\r\n\t\tlet category = this.getCategoryById(id);\r\n\t\tif(category === -1) return -1;\r\n\r\n\t\tcategory.feeds = 0;\r\n\t\tfor (let i=0; i < this.Data.Feeds.length; i++ ) if(this.Data.Feeds[i].categories.indexOf(id) !== -1) category.feeds++;\r\n\t\treturn category.feeds;\r\n\t},\r\n\r\n\tcountFeedsinAllCategories(){\r\n\t\tfor (let i=0; i < this.Data.Categories.length; i++ ) this.countFeedsinCategory( this.Data.Categories[i].id );\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t * [updateAllFeeds description]\r\n\t * @return {[type]} [description]\r\n\t */\r\n\tgetAllFeeds(){\r\n\t\treturn new Promise( (_resolve, _reject)=>{\r\n\t\t\tpg.log('pg.updateAllFeeds(): Updating all Feeds...');\r\n\t\t\tvar currentFeed = -1;\r\n\t\t\t// Loop through the Feeds with array.reduce...\r\n\t\t\tthis.Data.Feeds.reduce( (sequence) => {\r\n\t\t\t\treturn sequence.then( ()=> {\r\n\t\t\t\t\tcurrentFeed++;\r\n\t\t\t \t\treturn this.getFeed(currentFeed);\r\n\t\t\t\t}).then( (result)=> {\r\n\t\t\t\t\tif(result) pg.log('pg.updateAllFeeds(): Feed #'+ ( currentFeed + 1) +' ' + this.Data.Feeds[currentFeed].name + ' UPDATED' );\r\n\t\t\t    \telse  pg.log('pg.updateAllFeeds(): Feed #'+ ( currentFeed + 1) +' ' + this.Data.Feeds[currentFeed].name + ' FAILED' );\r\n\t\t\t  \t\tif( (currentFeed + 1)=== this.Data.Feeds.length) _resolve();\r\n\t\t\t  \t});\r\n\t\t\t} , Promise.resolve());\r\n\t\t});\r\n\t},\r\n\t/**\r\n\t * [updateFeed description]\r\n\t * @param  {[type]} i [description]\r\n\t * @return {[type]}   [description]\r\n\t */\r\n\tgetFeed(i){\r\n\t\treturn new Promise( (_resolve, _reject)=>{\r\n\t\t\tif(i === undefined || i === null || i === '') return _reject(-1);\r\n\r\n\t\t\t// get feed (allow feed array index or string url feed)\r\n\t\t\tlet feed;\r\n\t\t\tif( isNaN(i) && typeof i === 'string' ) feed = { url : i , name : '***'};\r\n\t\t\telse feed = this.Data.Feeds[i];\r\n\r\n\t\t\t// block if requested feed does not exist\r\n\t\t\tif(feed === undefined) return _reject(-1);\r\n\r\n\t\t\tpg.log('pg.updateFeed() : Updating Feed from :'+ feed.url +' ( ' + feed.name + ' )' );\r\n\r\n\t\t\t//\r\n\t\t\t// Prepare Ajax request\r\n\t\t\t//\r\n\t\t\tlet request = new XMLHttpRequest();\r\n\t\t\trequest.open('get', feed.url, true);\r\n\r\n\t\t\t// RESPONSE OK\r\n\t\t\trequest.onload  = ()=>{\r\n\t\t\t\tlet parser = new DOMParser();\r\n\t\t\t   \tlet xmlDoc = parser.parseFromString(request.responseText,'text/xml');\r\n\t\t\t\tlet JSONxml = JSON.parseXML(xmlDoc);\r\n\r\n\t\t\t\trequest = null;\r\n\t\t\t\treturn _resolve(JSONxml);\r\n\t\t\t};\r\n\t\t\t// RESPONSE FAIL\r\n\t\t\trequest.onerror  = ()=>{\r\n\t\t\t\tpg.log('pg.getFeed(): Error on request.', request.statusText);\r\n\t\t\t\trequest = null;\r\n\t\t\t\treturn _resolve(false);\r\n\t\t\t};\r\n\t\t\t// Send Request\r\n\t\t\trequest.send(null);\r\n\t\t});\r\n\t},\r\n\r\n\ttoogleArrayItem(item, array, event, object){\r\n\t\tlet i = array.indexOf(item);\r\n\t\tif(i === -1) array.push(item);\r\n\t\telse array.splice(i, 1);\r\n\t\tconsole.log(arguments);\r\n\t}\r\n};\r\n\r\nexport default main;\r\n"]}