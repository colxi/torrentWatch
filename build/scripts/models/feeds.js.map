{"version":3,"sources":["feeds.es6"],"names":["feeds","__constructor","Promise","_resolve","pg","load","model","then","r","page","limit","sortBy","order","items","JSON","parse","stringify","models","storage","Data","firstIndex","lastIndex","length","slice","get","id","original","i","getIndexById","delete","resolve","console","log","splice","categories","updateFeedCount","sync","save","feed","new","guid","name","undefined","url","fields","available","assignations","title","magnet","TTL","status","lastCheck","code","details","getItemsProperties","prop","rss","channel","item","hasOwnProperty","charAt","match","push","findIndex"],"mappings":";;;;;AAAA;AACA;AACA;;AAGA,IAAIA,QAAQ;AACXC,cADW,2BACI;AACZ,SAAO,IAAIC,OAAJ,CAAY,UAASC,QAAT,EAAkB;AAC7BC,MAAGC,IAAH,CAAQC,KAAR,CAAc,SAAd,EAAyB,YAAzB,EAAuCC,IAAvC,CAA6C;AAAA,WAAGJ,SAASK,CAAT,CAAH;AAAA,IAA7C;AACH,GAFE,CAAP;AAGF,EALU;AAOXC,KAPW,kBAO4C;AAAA,MAAjDA,KAAiD,uEAA1C,CAA0C;;AAAA,MAAtCC,KAAsC,uEAAhC,EAAgC;AAAA,MAA5BC,MAA4B,uEAAnB,EAAmB;AAAA,MAAdC,KAAc,uEAAR,MAAQ;;AAChD;AACA,MAAIC,QAAQC,KAAKC,KAAL,CAAYD,KAAKE,SAAL,CAAeZ,GAAGa,MAAH,CAAUC,OAAV,CAAkBC,IAAlB,CAAuBnB,KAAtC,CAAZ,CAAZ;;AAEA;AACA;;AAEH;AACG,MAAGS,QAAO,CAAV,EAAY;AACX,OAAIW,aAAcX,QAAOC,KAAR,GAAiBA,KAAlC;AACA,OAAIW,YAAaD,aAAaV,KAAb,GAAqB,CAAtB,GAA2BG,MAAMS,MAAjC,GAA2CF,aAAaV,KAAxD,GAAkEG,MAAMS,MAAxF;AACAT,WAAQA,MAAMU,KAAN,CAAYH,UAAZ,EAAwBC,SAAxB,CAAR;AACA;AACD;AACA,SAAOR,KAAP;AACH,EAtBO;AAwBRW,IAxBQ,iBAwBmB;AAAA,MAAvBC,EAAuB,uEAApB,EAAoB;AAAA,MAAjBC,QAAiB,uEAAN,KAAM;;AAC7B,MAAIC,IAAI3B,MAAM4B,YAAN,CAAmBH,EAAnB,CAAR;AACA,SAAQE,MAAM,CAAC,CAAR,GAAa,CAAC,CAAd,GAAqBD,WAAWtB,GAAGa,MAAH,CAAUC,OAAV,CAAkBC,IAAlB,CAAuBnB,KAAvB,CAA6B2B,CAA7B,CAAX,GAA6Cb,KAAKC,KAAL,CAAYD,KAAKE,SAAL,CAAeZ,GAAGa,MAAH,CAAUC,OAAV,CAAkBC,IAAlB,CAAuBnB,KAAvB,CAA6B2B,CAA7B,CAAf,CAAZ,CAAzE;AACA,EA3BU;AA6BRE,OA7BQ,qBA6BK;AAAA,MAANJ,EAAM,uEAAH,EAAG;;AACT,SAAO,IAAIvB,OAAJ,CAAY,UAAS4B,OAAT,EAAiB;AACtCC,WAAQC,GAAR,CAAY,4CAA0CP,EAAtD;AACH;AACA,OAAIE,IAAI3B,MAAM4B,YAAN,CAAmBH,EAAnB,CAAR;AACA;AACA,OAAGE,MAAM,CAAC,CAAV,EAAaG,QAAQ,KAAR;AACb;AACA1B,MAAGa,MAAH,CAAUC,OAAV,CAAkBC,IAAlB,CAAuBnB,KAAvB,CAA6BiC,MAA7B,CAAoCN,CAApC,EAAsC,CAAtC;AACA;AACAvB,MAAGa,MAAH,CAAUiB,UAAV,CAAqBC,eAArB;AACA/B,MAAGa,MAAH,CAAUC,OAAV,CAAkBkB,IAAlB,CAAuBpC,KAAvB,GAA+BO,IAA/B,CAAqC;AAAA,WAAKuB,QAAQ,IAAR,CAAL;AAAA,IAArC;AACA,GAXY,CAAP;AAYH,EA1CO;AA4CXO,KA5CW,gBA4CLC,IA5CK,EA4CC;AACL,SAAO,IAAIpC,OAAJ,CAAY,UAAS4B,OAAT,EAAiB;AACzCC,WAAQC,GAAR,CAAY,wCAAwCM,KAAKb,EAAzD;AACA,OAAIE,IAAI3B,MAAM4B,YAAN,CAAmBU,KAAKb,EAAxB,CAAR;AACA,OAAGE,MAAM,CAAC,CAAV,EAAaA,IAAIvB,GAAGa,MAAH,CAAUC,OAAV,CAAkBC,IAAlB,CAAuBnB,KAAvB,CAA6BsB,MAAjC;AACblB,MAAGa,MAAH,CAAUC,OAAV,CAAkBC,IAAlB,CAAuBnB,KAAvB,CAA6B2B,CAA7B,IAAkCW,IAAlC;AACAlC,MAAGa,MAAH,CAAUiB,UAAV,CAAqBC,eAArB;AACA/B,MAAGa,MAAH,CAAUC,OAAV,CAAkBkB,IAAlB,CAAuBpC,KAAvB,GAA+BO,IAA/B,CAAqC;AAAA,WAAKuB,QAAQ,IAAR,CAAL;AAAA,IAArC;AACA,GAPY,CAAP;AAQN,EArDU;AAuDXS,IAvDW,kBAuDN;AACJ,SAAO;AACNd,OAASrB,GAAGoC,IAAH,EADH;AAENC,SAAUC,SAFJ;AAGNC,QAASD,SAHH;AAINE,WAAY;AACXC,eAAc,EADH;AAEXC,kBAAgB;AACfC,YAAWL,SADI;AAEfM,aAAYN,SAFG;AAGfC,UAASD;AAHM;AAFL,IAJN;AAYNR,eAAe,EAZT;AAaNe,QAAS,GAbH;AAcNC,WAAY;AACXC,eAAcT,SADH;AAEXU,UAAUV,SAFC;AAGXW,aAAYX;AAHD;AAdN,GAAP;AAoBA,EA5EU;AA8EXY,mBA9EW,8BA8EQhB,IA9ER,EA8Ea;AACvB,MAAIiB,OAAO,EAAX;AACA,OAAI,IAAI5B,CAAR,IAAaW,KAAKkB,GAAL,CAASC,OAAT,CAAiBC,IAAjB,CAAsB,CAAtB,CAAb,EAAsC;AACpC,OAAIpB,KAAKkB,GAAL,CAASC,OAAT,CAAiBC,IAAjB,CAAsB,CAAtB,EAAyBC,cAAzB,CAAwChC,CAAxC,KAA+CA,EAAEiC,MAAF,CAAS,CAAT,EAAYC,KAAZ,CAAkB,YAAlB,CAAnD,EAAqFN,KAAKO,IAAL,CAAUnC,CAAV;AACtF;AACD,SAAO4B,IAAP;AACA,EApFU;AAuFX3B,aAvFW,wBAuFEH,EAvFF,EAuFK;AACf,SAAOrB,GAAGa,MAAH,CAAUC,OAAV,CAAkBC,IAAlB,CAAuBnB,KAAvB,CAA6B+D,SAA7B,CAAwC;AAAA,UAAOzB,KAAKb,EAAL,KAAYA,EAAb,GAAoB,IAApB,GAA2B,KAAjC;AAAA,GAAxC,CAAP;AACA;AAzFU,CAAZ;;kBA4FezB,K","file":"feeds.js","sourcesContent":["/* jsHint inline configuration : */\n/* jshint undef: true, unused: false */\n/* global chrome , System , pg , rivets , sightglass */\n\n\nlet feeds = {\n\t__constructor(){\n\t   return new Promise(function(_resolve){\n            pg.load.model('storage', 'categories').then( r=>_resolve(r) );\n        });\n\t},\n\n\tpage( page = 0 , limit=10, sortBy = '' , order='DESC' ){\n        // get all items (clone array)\n        let items = JSON.parse( JSON.stringify(pg.models.storage.Data.feeds) );\n\n        // TO DO : sort by key\n        // TO DO : apply ASC DESC order\n\n    \t// if a page is requested, slice array , and select only corresponding items\n        if(page > 0){\n        \tlet firstIndex = (page * limit) - limit;\n        \tlet lastIndex = (firstIndex + limit - 1) < items.length ? (firstIndex + limit ) : items.length ;\n        \titems = items.slice(firstIndex, lastIndex);\n        }\n        // done ! return items;\n        return items;\n    },\n\n    get(id='',original = false){\n\t\tlet i = feeds.getIndexById(id);\n\t\treturn (i === -1) ? -1 :  ( original ? pg.models.storage.Data.feeds[i] : JSON.parse( JSON.stringify(pg.models.storage.Data.feeds[i]) ) );\n\t},\n\n    delete(id=''){\n        return new Promise(function(resolve){\n\t    \tconsole.log('[Model]:feeds.delete(): deleting feed #'+id);\n\t\t\t// get index in array\n\t\t\tlet i = feeds.getIndexById(id);\n\t\t\t// block if  id NOT found\n\t\t\tif(i === -1) resolve(false);\n\t\t\t// remove item from Data array\n\t\t\tpg.models.storage.Data.feeds.splice(i,1);\n\t\t\t// request to save new data\n\t\t\tpg.models.categories.updateFeedCount();\n\t\t\tpg.models.storage.sync.feeds().then( r => resolve(true) );\n\t\t});\n    },\n\n\tsave( feed ){\n        return new Promise(function(resolve){\n\t\t\tconsole.log('[Model]:feeds.save(): saving feed #' + feed.id);\n\t\t\tlet i = feeds.getIndexById(feed.id);\n\t\t\tif(i === -1) i = pg.models.storage.Data.feeds.length;\n\t\t\tpg.models.storage.Data.feeds[i] = feed;\n\t\t\tpg.models.categories.updateFeedCount();\n\t\t\tpg.models.storage.sync.feeds().then( r => resolve(true) );\n\t\t});\n\t},\n\n\tnew(){\n\t\treturn {\n\t\t\tid \t\t\t\t: pg.guid(),\n\t\t\tname \t\t\t: undefined,\n\t\t\turl \t\t\t: undefined,\n\t\t\tfields\t \t\t: {\n\t\t\t\tavailable \t\t: [],\n\t\t\t\tassignations \t: {\n\t\t\t\t\ttitle \t\t\t: undefined,\n\t\t\t\t\tmagnet \t\t\t: undefined,\n\t\t\t\t\turl \t\t\t: undefined\n\t\t\t\t}\n\t\t\t},\n\t\t\tcategories \t\t: [],\n\t\t\tTTL \t\t\t: 120,\n\t\t\tstatus \t\t\t: {\n\t\t\t\tlastCheck \t\t: undefined,\n\t\t\t\tcode \t\t\t: undefined,\n\t\t\t\tdetails \t\t: undefined\n\t\t\t}\n\t\t};\n\t},\n\n\tgetItemsProperties(feed){\n\t\tlet prop = [];\n\t\tfor(let i in feed.rss.channel.item[0]){\n\t\t \tif( feed.rss.channel.item[0].hasOwnProperty(i) &&  i.charAt(0).match(/[A-Z|a-z]/i) ) prop.push(i);\n\t\t}\n\t\treturn prop;\n\t},\n\n\n\tgetIndexById(id){\n\t\treturn pg.models.storage.Data.feeds.findIndex( feed=>(feed.id === id ) ? true : false );\n\t},\n};\n\nexport default feeds;\n"]}