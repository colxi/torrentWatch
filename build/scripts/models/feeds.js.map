{"version":3,"sources":["feeds.es6"],"names":[],"mappings":"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","file":"feeds.js","sourcesContent":["/* jsHint inline configuration : */\r\n/* jshint undef: true, unused: false */\r\n/* global chrome , System , pg , rivets , sightglass */\r\n\r\n\r\nlet app;\r\n\r\nlet feeds = {\r\n\t__constructor(){\r\n\t\treturn new Promise(function(resolve){\r\n\t\t\tpg.load.model('app').then( m =>{\r\n\t\t\t\tapp = m;\r\n\t\t\t\tresolve();\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\r\n\tlocation : 'feeds/list',\r\n\r\n\tinitialize : function(){ feeds.list.initialize(); },\r\n\r\n\tlist : {\r\n\t\ttarget : null,\r\n\r\n\t\tinitialize :  function(mode = 'insert'){\r\n\t\t\tfeeds.location = 'feeds/list';\r\n\t\t},\r\n\r\n\t\tshow_deleteFeedDialog: function(id){\r\n\t\t\tfeeds.list.target = app.getFeedById(id);\r\n\t\t\tfeeds.location = 'feeds/list_delete';\r\n\t\t},\r\n\r\n\t\tdelete_feed: function(id){\r\n\t\t\tapp.deleteFeed(id);\r\n\t\t\tfeeds.list.initialize();\r\n\t\t}\r\n\t},\r\n\r\n\tform : {\r\n\t\tactive \t\t\t\t: 'feedDeclarationForm',\r\n\t\tmode \t\t\t\t: 'insert', // | update\r\n\t\terror \t\t\t\t: false,\r\n\t\ttitle: {\r\n\t\t\tinsert \t\t\t: 'New Feed :',\r\n\t\t\tupdate \t\t\t: 'Edit Feed :'\r\n\t\t},\r\n\r\n\t\tUI : {\r\n\t\t\tfeedDeclarationForm \t: null,\r\n\t\t\tfeedAssignationsForm \t: null,\r\n\t\t\tfeedUrl \t\t\t\t: null\r\n\t\t},\r\n\r\n\t\tData : {},\r\n\r\n\r\n\t\tinitialize :  function(id = null){\r\n\t\t\tif( id !== null ){\r\n\t\t\t\t// EDIT MODE DETECTED! ... get Feed Data\r\n\t\t\t\tlet feed = app.getFeedById(id);\r\n\t\t\t\tif( feed === -1) throw new Error('feeds.form.initialize(): Can\\'t find Feed with ID : '+ id);\r\n\t\t\t\tfeeds.form.mode = 'update';\r\n\t\t\t\tfeeds.form.Data = feed;\r\n\t\t\t}else{\r\n\t\t\t\t// INSERT MODE DETECTED ... generate new Feed\r\n\t\t\t\tfeeds.form.mode \t= 'insert';\r\n\t\t\t\tfeeds.form.Data \t= app.emptyFeed();\r\n\t\t\t\tfeeds.form.Data.id \t= pg.guid();\r\n\t\t\t}\r\n\r\n\t\t\tfeeds.form.error \t= false;\r\n\t\t\tfeeds.location \t\t= 'feeds/form';\r\n\t\t\tfeeds.form.show_feedDeclarationForm();\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\tshow_feedDeclarationForm: function(){ feeds.form.active = 'feedDeclarationForm'; },\r\n\t\tshow_feedAssignationsForm: function(){ feeds.form.active = 'feedAssignationsForm'; },\r\n\r\n\t\tvalidate_feedDeclarationForm: function(){\r\n\t\t\tpg.log( 'feeds.form.validate_feedDeclaration(): Validating Feed Declaration...' );\r\n\t\t\t// reset previous form validations\r\n\t\t\tfeeds.form.error = false;\r\n\t\t\tfeeds.form.UI.feedUrl.setCustomValidity('');\r\n\t\t\t// validate form\r\n\t\t\tif( !feeds.form.UI.feedDeclarationForm.checkValidity() ){\r\n\t\t\t\tpg.log( 'feeds.form.validate_feedDeclaration(): Form validation failed...' );\r\n\t\t\t\tfeeds.form.error = 'Some fields require your attention.';\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t// show loader\r\n\t\t\tpg.loader(feeds.form.UI.feedDeclarationForm).show('Validating Feed Source...');\r\n\t\t\t//\r\n\t\t\t// asyncronic feed url validation\r\n\t\t\t//\r\n\t\t\tapp.getFeed(feeds.form.Data.url).then(function(_feed){\r\n\t\t\t\t// done! hide loader\r\n\t\t\t\tpg.loader(feeds.form.UI.feedDeclarationForm).hide();\r\n\t\t\t\t// block and return if failed\r\n\t\t\t\tif(!_feed){\r\n\t\t\t\t\tpg.log( 'feeds.form.validate_feedDeclaration(): URL validation failed...' );\r\n\t\t\t\t\tfeeds.form.error = 'RSS Feed not found in URL.';\r\n\t\t\t\t\tfeeds.form.UI.feedUrl.setCustomValidity('RSS Feed not found in URL.');\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\t// TO DO:\r\n\t\t\t\t//  - validate structure 'rss.channel.item'\r\n\t\t\t\t//  - validate item length > 0\r\n\r\n\t\t\t\t// store FEED ITEMS\r\n\t\t\t\tfeeds.form.Data.__items = _feed.rss.channel.item;\r\n\t\t\t\t// succeed, get RSS feed item properties structure\r\n\t\t\t\tfeeds.form.Data.fields.available  =  app.getFeedItemsProperties(_feed);\r\n\t\t\t\t// DONE ! show next FORM!\r\n\t\t\t\tfeeds.form.show_feedAssignationsForm();\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tvalidate_feedAssignationsForm: function(){\r\n\t\t\tpg.log( 'feeds.form.validate_feedAssignationsForm(): Validating Feed Assignations...' );\r\n\t\t\t// reset previous form validations\r\n\t\t\tfeeds.form.error = false;\r\n\t\t\t// validate form\r\n\t\t\tif( !feeds.form.UI.feedAssignationsForm.checkValidity() ){\r\n\t\t\t\tpg.log( 'feeds.form.validate_feedAssignationsForm(): Form validation failed...' );\r\n\t\t\t\tfeeds.form.error = 'Some fields require your attention.';\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t// save feed Data\r\n\t\t\tapp.saveFeed({\r\n\t\t\t\tid: feeds.form.Data.id,\r\n\t\t\t\tname: feeds.form.Data.name,\r\n\t\t\t\turl : feeds.form.Data.url,\r\n\t\t\t\tfields: {\r\n\t\t\t\t\tavailable: feeds.form.Data.fields.available,\r\n\t\t\t\t\tassignations: {\r\n\t\t\t\t\t\ttitle: feeds.form.Data.fields.assignations.title,\r\n\t\t\t\t\t\tmagnet: feeds.form.Data.fields.assignations.magnet,\r\n\t\t\t\t\t\turl: feeds.form.Data.fields.assignations.url\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tTTL: feeds.form.Data.TTL,\r\n\t\t\t\tcategories: feeds.form.Data.categories,\r\n\t\t\t\tstatus: {\r\n\t\t\t\t\tlastCheck: new Date(),\r\n\t\t\t\t\tcode: 200,\r\n\t\t\t\t\tdetails: undefined\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t// DONE! display ending message!\r\n\t\t\tfeeds.location = 'feeds/form_completed';\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nexport default feeds;\r\n"]}