{"version":3,"sources":["feeds.es6"],"names":[],"mappings":"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","file":"feeds.js","sourcesContent":["/* jsHint inline configuration : */\r\n/* jshint undef: true, unused: false */\r\n/* global chrome , System , pg , rivets , sightglass */\r\n\r\n\r\nlet feeds = {\r\n\t__constructor(){\r\n\t   return new Promise(function(_resolve){\r\n            pg.load.model('storage', 'categories').then( r=>_resolve(r) );\r\n        });\r\n\t},\r\n\r\n\tpage( page = 0 , limit=10, sortBy = '' , order='DESC'){\r\n        return new Promise(function(resolve){\r\n            // get all items (clone array)\r\n            let items = JSON.parse( JSON.stringify(pg.models.storage.Data.feeds) );\r\n\r\n            // TO DO : sort by key\r\n            // TO DO : apply ASC DESC order\r\n\r\n        \t// if a page is requested, slice array , and select only corresponding items\r\n            if(page > 0){\r\n            \tlet firstIndex = (page * limit) - limit;\r\n            \tlet lastIndex = (firstIndex + limit - 1) < items ? (firstIndex + limit - 1) : items - 1;\r\n            \titems = items.slice(firstIndex, lastIndex);\r\n            }\r\n            // done ! return items;\r\n            resolve( items );\r\n        });\r\n    },\r\n\r\n    get(id='',original = false){\r\n\t\tlet i = feeds.getIndexById(id);\r\n\t\treturn (i === -1) ? -1 :  ( original ? pg.models.storage.Data.feeds[i] : JSON.parse( JSON.stringify(pg.models.storage.Data.feeds[i]) ) );\r\n\t},\r\n\r\n    delete(id=''){\r\n        return new Promise(function(resolve){\r\n\t    \tconsole.log('[Model]:feeds.delete(): deleting feed #'+id);\r\n\t\t\t// get index in array\r\n\t\t\tlet i = feeds.getIndexById(id);\r\n\t\t\t// block if  id NOT found\r\n\t\t\tif(i === -1) resolve(false);\r\n\t\t\t// remove item from Data array\r\n\t\t\tpg.models.storage.Data.feeds.splice(i,1);\r\n\t\t\t// request to save new data\r\n\t\t\tpg.models.storage.sync.feeds()\r\n\t\t\t\t// update categories dependent Data\r\n\t\t\t\t.then( r => pg.models.categories.updateFeedCount() )\r\n\t\t\t\t// done!\r\n\t\t\t\t.then( r => resolve(true) );\r\n\t\t});\r\n    },\r\n\r\n\tsave( feed ){\r\n        return new Promise(function(resolve){\r\n\t\t\tconsole.log('[Model]:feeds.save(): saving feed #' + feed.id);\r\n\t\t\tlet i = feeds.getIndexById(feed.id);\r\n\t\t\tif(i === -1) i = pg.models.storage.Data.feeds.length;\r\n\t\t\tpg.models.storage.Data.feeds[i] = feed;\r\n\t\t\tpg.models.storage.sync.feeds()\r\n\t\t\t\t// update categories dependent Data\r\n\t\t\t\t.then( r => pg.models.categories.updateFeedCount() )\r\n\t\t\t\t// done!\r\n\t\t\t\t.then( r => resolve(true) );\r\n        });\r\n\r\n\t},\r\n\r\n\r\n\tnew(){\r\n\t\treturn {\r\n\t\t\tid \t\t\t\t: pg.guid(),\r\n\t\t\tname \t\t\t: undefined,\r\n\t\t\turl \t\t\t: undefined,\r\n\t\t\tfields\t \t\t: {\r\n\t\t\t\tavailable \t\t: [],\r\n\t\t\t\tassignations \t: {\r\n\t\t\t\t\ttitle \t\t\t: undefined,\r\n\t\t\t\t\tmagnet \t\t\t: undefined,\r\n\t\t\t\t\turl \t\t\t: undefined\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcategories \t\t: [],\r\n\t\t\tTTL \t\t\t: 120,\r\n\t\t\tstatus \t\t\t: {\r\n\t\t\t\tlastCheck \t\t: undefined,\r\n\t\t\t\tcode \t\t\t: undefined,\r\n\t\t\t\tdetails \t\t: undefined\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\r\n\r\n\tgetIndexById(id){\r\n\t\treturn pg.models.storage.Data.feeds.findIndex( feed=>(feed.id === id ) ? true : false );\r\n\t},\r\n};\r\n\r\nexport default feeds;\r\n"]}