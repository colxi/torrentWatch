{"version":3,"sources":["categories.es6"],"names":["categories","__constructor","Promise","_resolve","pg","load","model","then","r","page","limit","sortBy","order","items","JSON","parse","stringify","models","storage","Data","firstIndex","lastIndex","length","slice","get","id","original","i","getIndexById","getByName","name","delete","resolve","console","log","splice","sync","save","category","updateFeedCount","new","guid","undefined","feeds","_update","indexOf","findIndex"],"mappings":"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","file":"categories.js","sourcesContent":["/* jsHint inline configuration : */\n/* jshint undef: true, unused: false */\n/* global chrome , System , pg , rivets , sightglass */\n\n\nlet categories = {\n\t__constructor(){\n\t   return new Promise(function(_resolve){\n            pg.load.model('storage').then( r=>_resolve(r) );\n        });\n\t},\n\n\tpage( page = 0 , limit=10, sortBy = '' , order='DESC' ){\n        // get all items (clone array)\n        let items = JSON.parse( JSON.stringify(pg.models.storage.Data.categories) );\n\n        // TO DO : sort by key\n        // TO DO : apply ASC DESC order\n\n    \t// if a page is requested, slice array , and select only corresponding items\n        if(page > 0){\n        \tlet firstIndex = (page * limit) - limit;\n        \tlet lastIndex = (firstIndex + limit - 1) < items.length ? (firstIndex + limit ) : items.length ;\n        \titems = items.slice(firstIndex, lastIndex);\n        }\n        // done ! return items;\n        return items;\n    },\n\n    get(id='',original = false){\n\t\tlet i = categories.getIndexById(id);\n\t\treturn (i === -1) ? -1 :  ( original ? pg.models.storage.Data.categories[i] : JSON.parse( JSON.stringify(pg.models.storage.Data.categories[i]) ) );\n\t},\n\n\tgetByName(name){\n\t\tfor(let i = 0; i < pg.models.storage.Data.categories.length; i++){\n\t\t\tif(pg.models.storage.Data.categories[i].name === name) return pg.models.storage.Data.categories[i];\n\t\t}\n\t\treturn -1;\n\t},\n\n    delete(id=''){\n        return new Promise(function(resolve){\n\t    \tconsole.log('[Model]:categories.delete(): deleting feed #'+id);\n\t\t\t// get index in array\n\t\t\tlet i = categories.getIndexById(id);\n\t\t\t// block if  id NOT found\n\t\t\tif(i === -1) resolve(false);\n\t\t\t// remove item from Data array\n\t\t\tpg.models.storage.Data.categories.splice(i,1);\n\t\t\t// request to save new data\n\t\t\tpg.models.storage.sync.categories().then( r => resolve(true) );\n\t\t});\n    },\n\n\tsave( category ){\n        return new Promise(function(resolve){\n\t\t\tconsole.log('[Model]:categories.save(): saving category #' + category.id);\n\t\t\tlet i = categories.getIndexById(category.id);\n\t\t\tif(i === -1) i = pg.models.storage.Data.categories.length;\n\t\t\tpg.models.storage.Data.categories[i] = category;\n\t\t\tcategories.updateFeedCount();\n\t\t\tpg.models.storage.sync.categories().then( r => resolve(true) );\n        });\n\t},\n\n\tnew(){\n\t\treturn {\n\t\t\tid \t\t: pg.guid(),\n\t\t\tname \t: undefined,\n\t\t\tfeeds \t: 0\n\t\t};\n\t},\n\n\tupdateFeedCount(id=undefined){\n\t\tlet _update = function(id){\n\t\t\tlet category = categories.get(id);\n\t\t\tif(category === -1) return -1;\n\n\t\t\tcategory.feeds = 0;\n\t\t\tfor (let i=0; i < pg.models.storage.Data.feeds.length; i++ ) if(pg.models.storage.Data.feeds[i].categories.indexOf(id) !== -1) category.feeds++;\n\t\t\treturn category.feeds;\n\t\t};\n\t\tif(typeof id === 'undefined') for (let i=0; i < pg.models.storage.Data.categories.length; i++ ) _update( pg.models.storage.Data.categories[i].id );\n\t\telse _update( id );\n\t\treturn true;\n\t},\n\n\n\tgetIndexById(id){\n\t\treturn pg.models.storage.Data.categories.findIndex( category=>(category.id === id ) ? true : false );\n\t},\n};\n\nexport default categories;\n"]}